@page
@model CMS.Pages.Admin.CustomizeModel
@{
    ViewData["Title"] = "Tùy chỉnh cấu trúc Thẻ";
    // Nếu file _Layout.cshtml của bạn nằm ở chỗ khác, hãy sửa lại đường dẫn này nhé
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<style>
    /* 1. TĂNG KÍCH THƯỚC TỔNG THỂ CÂY THƯ MỤC */
    .custom-tree, .child-list {
        list-style-type: none;
        padding-left: 25px; /* Thụt lề sâu hơn cho rõ cấp bậc */
        font-size: 1.1rem; /* Phóng to cỡ chữ nền tảng */
    }

    /* 2. THƯ MỤC GỐC (Cha - Cấp 1) */
    .folder-header {
        cursor: pointer;
        padding: 16px 20px; /* Thanh bấm dày và rộng hơn */
        background-color: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 12px;
        transition: background-color 0.2s;
    }

        .folder-header:hover {
            background-color: #e2e6ea;
        }

        .folder-header .fs-5 {
            font-size: 1.4rem !important; /* Tên thư mục gốc to, rõ ràng */
        }

        .folder-header i {
            font-size: 1.25rem; /* Icon sao và thư mục to tương xứng */
        }

    /* 3. THƯ MỤC CON (Cấp 2) */
    .child-item {
        background-color: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 15px; /* Các thư mục con cách xa nhau ra cho thoáng */
        margin-left: 25px;
        overflow: hidden;
    }

    .child-header {
        cursor: pointer;
        padding: 14px 20px; /* Không gian bấm của mục con cũng rộng ra */
        transition: background-color 0.2s;
        font-size: 1.2rem; /* Chữ to lên */
    }

        .child-header:hover {
            background-color: #f8f9fa;
        }

    /* Icon mũi tên xổ xuống to ra một chút */
    .toggle-icon-child {
        font-size: 1.1rem !important;
        margin-right: 12px !important;
    }

    /* 4. RUỘT BÊN TRONG (Bài viết & Sidebar) */
    .child-content {
        background-color: #fdfdfd;
        border-top: 1px dashed #e0e0e0;
        padding: 20px; /* Form ruột rộng rãi */
    }

    .content-box {
        padding: 14px 18px; /* Thẻ chứa bài viết dày dặn hơn */
        background-color: #ffffff;
        border: 1px dashed #ccc;
        border-radius: 6px;
        font-size: 1.05rem; /* Chữ bên trong to dễ đọc */
        line-height: 1.6;
    }

    /* 5. NÚT BẤM (Sửa bài, Tùy chọn) */
    .btn-xs {
        padding: 0.35rem 0.6rem; /* Nút to ra dễ bấm chuột */
        font-size: 0.95rem;
        border-radius: 5px;
        margin-top: -3px;
    }

    .dropdown-toggle {
        font-size: 1rem; /* Nút tùy chọn to lên */
        padding: 0.3rem 0.8rem;
    }
</style>

<div class="container-fluid mt-4">
    <div class="card shadow">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Quản lý cấu trúc Thẻ MUCE CMS</h5>
            <a asp-page="/Admin/Wizard/Step1_Menu" class="btn btn-sm btn-success">
                <i class="fas fa-plus"></i> Thêm Thư mục gốc
            </a>
        </div>
        <div class="card-body">
            <ul class="custom-tree">
                @foreach (var folder in Model.TreeData)
                {
                    <li class="parent-item mt-3">
                        <div class="folder-header d-flex justify-content-between align-items-center" onclick="toggleFolder(this)">
                            <div>
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-folder folder-icon text-secondary"></i>
                                <span class="fw-bold fs-5 ms-1">@folder.ParentMenu.Name</span>
                            </div>

                            <div class="dropdown" onclick="event.stopPropagation();">
                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-cog"></i> Tùy chọn
                                </button>
                                <ul class="dropdown-menu shadow">
                                    <li><a class="dropdown-item text-primary" href="/Admin/NavigationMenus/Edit?id=@folder.ParentMenu.Id"><i class="fas fa-edit"></i> Sửa Menu gốc</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" href="/Admin/NavigationMenus/Delete?id=@folder.ParentMenu.Id"><i class="fas fa-trash"></i> Xóa</a></li>
                                </ul>
                            </div>
                        </div>

                        <ul class="child-list" style="display: none;">

                            <div class="parent-content-box mb-4 p-3 shadow-sm" style="background-color: #f1f3f5; border-left: 4px solid #ffc107; border-radius: 6px; margin-left: 25px; margin-right: 20px; margin-top: 15px;">
                                <h6 class="text-secondary fw-bold mb-3"><i class="fas fa-info-circle"></i> Nội dung của trang @folder.ParentMenu.Name:</h6>

                                <div class="content-box mb-3 shadow-sm">
                                    <i class="fas fa-file-alt text-success"></i>
                                    <strong>Bài viết chính:</strong> @folder.ArticleTitle
                                    @if (folder.ArticleId.HasValue)
                                    {
                                        <a href="/Admin/ContentPages/Edit?id=@folder.ArticleId" class="btn btn-xs btn-outline-success float-end"><i class="fas fa-pen"></i> Sửa bài</a>
                                    }
                                    else
                                    {
                                        <a href="/Admin/ContentPages/Create" class="btn btn-xs btn-success float-end"><i class="fas fa-plus"></i> Tạo bài</a>
                                    }
                                </div>

                                <div class="content-box shadow-sm">
                                    <i class="fas fa-list-ul text-info"></i>
                                    <strong>Sidebar chính:</strong> @folder.SidebarTitle
                                    @if (folder.SidebarId.HasValue)
                                    {
                                        <a href="/Admin/SidebarItems/Edit?id=@folder.SidebarId" class="btn btn-xs btn-outline-info float-end"><i class="fas fa-pen"></i> Sửa Sidebar</a>
                                    }
                                </div>
                            </div>
                            @if (folder.ChildItems.Any())
                            {
                                foreach (var child in folder.ChildItems)
                                {
                                    <li class="child-item">
                                        <div class="d-flex justify-content-between align-items-center child-header" onclick="toggleChildContent(this)">
                                            <div>
                                                <i class="fas fa-chevron-right me-2 text-muted toggle-icon-child"></i>
                                                <i class="fas fa-folder text-info folder-icon-child"></i>
                                                <span class="fw-bold ms-1">@child.ChildMenu.Name</span>
                                            </div>

                                            <div class="dropdown" onclick="event.stopPropagation();">
                                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                    <i class="fas fa-cog"></i> Tùy chọn
                                                </button>
                                                <ul class="dropdown-menu shadow">
                                                    <li><a class="dropdown-item text-primary" href="/Admin/NavigationMenus/Edit?id=@child.ChildMenu.Id"><i class="fas fa-edit"></i> Sửa Menu này</a></li>
                                                    <li><hr class="dropdown-divider"></li>
                                                    <li><a class="dropdown-item text-danger" href="/Admin/NavigationMenus/Delete?id=@child.ChildMenu.Id"><i class="fas fa-trash"></i> Xóa</a></li>
                                                </ul>
                                            </div>
                                        </div>

                                        <div class="child-content" style="display: none;">
                                            <div class="content-box">
                                                <i class="fas fa-file-alt text-success"></i>
                                                <strong>Bài viết:</strong> @child.ArticleTitle

                                                @if (child.ArticleId.HasValue)
                                                {
                                                    <a href="/Admin/ContentPages/Edit?id=@child.ArticleId" class="btn btn-xs btn-outline-success float-end"><i class="fas fa-pen"></i> Sửa bài</a>
                                                }
                                                else
                                                {
                                                    <a href="/Admin/ContentPages/Create" class="btn btn-xs btn-success float-end"><i class="fas fa-plus"></i> Tạo bài</a>
                                                }
                                            </div>

                                            <div class="content-box mt-2">
                                                <i class="fas fa-list-ul text-info"></i>
                                                <strong>Sidebar:</strong> @child.SidebarTitle

                                                @if (child.SidebarId.HasValue)
                                                {
                                                    <a href="/Admin/SidebarItems/Edit?id=@child.SidebarId" class="btn btn-xs btn-outline-info float-end"><i class="fas fa-pen"></i> Sửa Sidebar</a>
                                                }
                                            </div>
                                        </div>
                                    </li>
                                }
                            }
                            else
                            {
                                <li class="child-item">
                                    <span class="text-muted fst-italic">Chưa có danh mục con nào...</span>
                                </li>
                            }
                        </ul>
                    </li>
                }
            </ul>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // 1. Xử lý đóng/mở Thư mục gốc (Màu xám)
        function toggleFolder(element) {
            // Dùng jQuery để tìm phần tử
            var $childList = $(element).next('.child-list');
            var $icon = $(element).find('.folder-icon');

            // Đổi Icon ngay lập tức để người dùng thấy web phản hồi tức thì
            if ($childList.is(':visible')) {
                $icon.removeClass('fa-folder-open').addClass('fa-folder');
            } else {
                $icon.removeClass('fa-folder').addClass('fa-folder-open');
            }

            // Tạo hiệu ứng trượt mượt mà trong 250 mili-giây
            $childList.slideToggle(250);
        }

        // 2. Xử lý đóng/mở Thư mục con (Màu xanh/trắng)
        function toggleChildContent(element) {
            var $content = $(element).next('.child-content');
            var $toggleIcon = $(element).find('.toggle-icon-child');
            var $folderIcon = $(element).find('.folder-icon-child');

            // Đổi Icon tức thì
            if ($content.is(':visible')) {
                $toggleIcon.removeClass('fa-chevron-down').addClass('fa-chevron-right');
                $folderIcon.removeClass('fa-folder-open').addClass('fa-folder');
            } else {
                $toggleIcon.removeClass('fa-chevron-right').addClass('fa-chevron-down');
                $folderIcon.removeClass('fa-folder').addClass('fa-folder-open');
            }

            // Tạo hiệu ứng trượt êm ái
            $content.slideToggle(250);
        }
    </script>
}