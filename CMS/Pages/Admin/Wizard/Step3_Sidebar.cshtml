@page
@model CMS.Pages.Admin.Wizard.Step3_SidebarModel
@{
    ViewData["Title"] = "Bước 3: Cấu hình Sidebar";
}

<style>
    /* 1. NỀN CHUNG */
    body {
        background-color: #f0f2f5;
    }

    /* 2. CSS THANH TIẾN TRÌNH (Đồng bộ Bước 1 & 2) */
    .wizard-progress {
        display: flex;
        justify-content: space-between;
        position: relative;
        margin-bottom: 3rem;
        padding: 0 5rem;
    }

        .wizard-progress::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 5rem;
            right: 5rem;
            height: 4px;
            background-color: #e9ecef;
            z-index: 1;
            transform: translateY(-50%);
        }

    .step-item {
        position: relative;
        z-index: 2;
        text-align: center;
        background: #f0f2f5;
        padding: 0 15px;
    }

    .step-circle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #e9ecef;
        color: #6c757d;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.3rem;
        margin: 0 auto 0.5rem auto;
        border: 4px solid #f0f2f5;
    }

    .step-item.completed .step-circle {
        background-color: #198754;
        color: #fff;
    }

    .step-item.active .step-circle {
        background-color: #0d6efd;
        color: #fff;
        box-shadow: 0 0 0 5px rgba(13, 110, 253, 0.2);
    }

    .step-text {
        font-size: 0.9rem;
        font-weight: 700;
        color: #6c757d;
        text-transform: uppercase;
    }

    .step-item.active .step-text {
        color: #0d6efd;
    }

    .step-item.completed .step-text {
        color: #198754;
    }

    /* 3. KHUNG TRÌNH DUYỆT PREVIEW (REALISTIC) */
    .browser-mockup {
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }

    .browser-header {
        background: #f8f9fa;
        padding: 12px 16px;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .browser-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .dot-r {
        background-color: #ff5f56;
    }

    .dot-y {
        background-color: #ffbd2e;
    }

    .dot-g {
        background-color: #27c93f;
    }

    /* 4. KHU VỰC NỘI DUNG PREVIEW */
    .preview-body {
        display: flex;
        height: 500px; /* Giới hạn chiều cao để có thanh cuộn */
        overflow: hidden;
        background: #fdfdfd;
    }

    .preview-main-content {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
        transition: all 0.4s ease;
    }

        /* Style mô phỏng cho bài viết */
        .preview-main-content h1, .preview-main-content h2, .preview-main-content h3 {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .preview-main-content p {
            line-height: 1.7;
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 15px;
        }

        .preview-main-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 15px 0;
        }

    /* 5. SIDEBAR MẪU */
    .preview-sidebar {
        width: 320px;
        background: #fff;
        border-left: 1px solid #eee;
        padding: 25px;
        overflow-y: auto;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: -5px 0 15px rgba(0,0,0,0.02);
    }

        .preview-sidebar.is-hidden {
            width: 0;
            padding: 0;
            border-width: 0;
            opacity: 0;
        }

    .widget-title {
        font-size: 15px;
        font-weight: 700;
        text-transform: uppercase;
        color: #2c3e50;
        border-bottom: 2px solid #0d6efd;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }

    /* Tiện ích thêm cho Sidebar đẹp hơn */
    .group-hover-bg:hover {
        background-color: #f8f9fa;
    }

    .cursor-pointer {
        cursor: pointer;
    }

    .transition-all {
        transition: all 0.2s ease-in-out;
    }

    /* Custom Toggle Switch */
    .custom-switch .form-check-input {
        width: 4rem;
        height: 2rem;
        cursor: pointer;
    }

    .custom-switch .form-check-label {
        font-size: 1.2rem;
        font-weight: bold;
        cursor: pointer;
        padding-top: 0.3rem;
    }

    /* Scrollbar mỏng đẹp */
    .preview-main-content::-webkit-scrollbar, .preview-sidebar::-webkit-scrollbar {
        width: 6px;
    }

    .preview-main-content::-webkit-scrollbar-thumb, .preview-sidebar::-webkit-scrollbar-thumb {
        background-color: #cbd5e1;
        border-radius: 10px;
    }
</style>

<div class="container-fluid py-4 px-4">
    <div class="row mb-5">
        <div class="col-12 col-lg-10 mx-auto">
            <div class="wizard-progress">
                <div class="step-item completed"><div class="step-circle"><i class="bi bi-check-lg"></i></div><div class="step-text">Tạo Menu</div></div>
                <div class="step-item completed"><div class="step-circle"><i class="bi bi-check-lg"></i></div><div class="step-text">Viết bài</div></div>
                <div class="step-item active"><div class="step-circle">3</div><div class="step-text">Cấu hình Sidebar</div></div>
            </div>
        </div>
    </div>

    <div class="row g-4 justify-content-center">
        <div class="col-12 col-lg-5">
            <div class="card shadow-sm border-0 rounded-4 h-100">
                <div class="card-header bg-white border-bottom-0 pt-4 pb-0 px-4">
                    <h4 class="fw-bold text-dark"><i class="bi bi-layout-sidebar-reverse me-2 text-primary"></i>Cấu hình giao diện</h4>
                </div>

                <div class="card-body p-4 d-flex flex-column justify-content-between">
                    <div>
                        <div class="alert alert-info border-0 bg-info bg-opacity-10 text-dark rounded-3 mb-4">
                            <i class="bi bi-info-circle-fill text-info me-2"></i>
                            Bản xem trước bên phải đang hiển thị <strong>nội dung thực tế</strong> của bài viết bạn vừa soạn. Bật/Tắt Sidebar để xem bố cục thay đổi!
                        </div>

                        <form method="post" id="sidebarForm">
                            <input type="hidden" asp-for="ContentPageId" />

                            <div class="p-4 bg-light rounded-4 border text-center mb-4">
                                <h5 class="mb-3 text-secondary">Trạng thái hiển thị Sidebar</h5>
                                <div class="form-check form-switch custom-switch d-flex justify-content-center align-items-center gap-3">
                                    <input class="form-check-input mt-0" type="checkbox" asp-for="HasSidebar" id="toggleSidebarBtn">
                                    <label class="form-check-label m-0 text-primary" for="toggleSidebarBtn" id="toggleLabel">Đang BẬT</label>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-success w-100 py-3 rounded-pill fw-bold fs-5 shadow-sm">
                                <i class="bi bi-check2-circle me-2"></i> Hoàn tất & Xuất bản
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-7">
            <div class="card shadow-sm border-0 rounded-4 h-100 bg-transparent shadow-none">
                <div class="card-body p-0">
                    <p class="text-muted fw-bold text-uppercase small mb-2"><i class="bi bi-eye me-2"></i>Bản xem trước trực tiếp</p>

                    <div class="browser-mockup">
                        <div class="browser-header">
                            <div class="browser-dot dot-r"></div>
                            <div class="browser-dot dot-y"></div>
                            <div class="browser-dot dot-g"></div>
                            <div class="ms-3 bg-white rounded px-3 py-1 text-muted small border w-50" style="font-size: 0.75rem;">
                                <i class="bi bi-lock-fill me-1"></i> https://websitecuaban.com/bai-viet...
                            </div>
                        </div>

                        <div class="preview-body">
                            <div class="preview-main-content">
                                @if (!string.IsNullOrEmpty(Model.PreviewTitle))
                                {
                                    <h2 class="mb-3" style="color:#1a202c;">@Model.PreviewTitle</h2>
                                    <div class="d-flex align-items-center mb-4 text-muted small">
                                        <span class="me-3"><i class="bi bi-calendar3 me-1"></i> @DateTime.Now.ToString("dd/MM/yyyy")</span>
                                        <span><i class="bi bi-person-circle me-1"></i> Admin</span>
                                    </div>

                                    <div>@Html.Raw(Model.PreviewContent)</div>
                                }
                                else
                                {
                                    <h2 class="mb-3 text-secondary">Bài viết chưa có tiêu đề</h2>
                                    <p class="text-muted">Nội dung bài viết sẽ được hiển thị tại đây...</p>
                                }
                            </div>

                            <div class="preview-sidebar" id="previewSidebar">
                                <div class="mb-4">
                                    <h3 class="widget-title d-flex align-items-center">
                                        <i class="bi bi-folder2-open me-2 fs-5"></i>
                                        Chuyên mục: @(string.IsNullOrEmpty(Model.PreviewCategory) ? "Tin tức" : Model.PreviewCategory)
                                    </h3>
                                    <div class="list-group list-group-flush border rounded-3 overflow-hidden shadow-sm">
                                        <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3 bg-light text-primary fw-bold">
                                            Bài viết cùng chuyên mục
                                            <span class="badge bg-primary rounded-pill">Mới</span>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3 text-secondary">
                                            <i class="bi bi-arrow-right-short text-muted me-1"></i> Kiến thức tổng hợp
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3 text-secondary">
                                            <i class="bi bi-arrow-right-short text-muted me-1"></i> Tài liệu tham khảo
                                        </a>
                                    </div>
                                </div>

                                <div>
                                    <h3 class="widget-title d-flex align-items-center">
                                        <i class="bi bi-star-fill text-warning me-2 fs-6"></i> Bài viết nổi bật
                                    </h3>
                                    <div class="d-flex flex-column gap-3">

                                        <div class="d-flex align-items-start group-hover-bg p-2 rounded transition-all cursor-pointer">
                                            <div class="rounded-3 d-flex justify-content-center align-items-center text-white bg-secondary bg-gradient shadow-sm flex-shrink-0" style="width: 70px; height: 50px;">
                                                <i class="bi bi-image fs-5 opacity-50"></i>
                                            </div>
                                            <div class="ms-3">
                                                <h6 class="mb-1 text-dark fw-bold" style="font-size: 13px; line-height: 1.4;">Bí quyết tối ưu quy trình làm việc hiệu quả</h6>
                                                <small class="text-muted d-flex align-items-center" style="font-size: 11px;">
                                                    <i class="bi bi-clock me-1"></i> 2 giờ trước
                                                </small>
                                            </div>
                                        </div>

                                        <div class="d-flex align-items-start group-hover-bg p-2 rounded transition-all cursor-pointer">
                                            <div class="rounded-3 d-flex justify-content-center align-items-center text-white bg-secondary bg-gradient shadow-sm flex-shrink-0" style="width: 70px; height: 50px;">
                                                <i class="bi bi-image fs-5 opacity-50"></i>
                                            </div>
                                            <div class="ms-3">
                                                <h6 class="mb-1 text-dark fw-bold" style="font-size: 13px; line-height: 1.4;">Cập nhật chính sách mới nhất năm nay</h6>
                                                <small class="text-muted d-flex align-items-center" style="font-size: 11px;">
                                                    <i class="bi bi-clock me-1"></i> 1 ngày trước
                                                </small>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const toggleBtn = document.getElementById('toggleSidebarBtn');
            const previewSidebar = document.getElementById('previewSidebar');
            const toggleLabel = document.getElementById('toggleLabel');

            // Hàm cập nhật giao diện dựa trên trạng thái Checkbox
            function updatePreview() {
                if (toggleBtn.checked) {
                    previewSidebar.classList.remove('is-hidden');
                    toggleLabel.textContent = "Đang BẬT";
                    toggleLabel.classList.replace('text-secondary', 'text-primary');
                } else {
                    previewSidebar.classList.add('is-hidden');
                    toggleLabel.textContent = "Đang TẮT";
                    toggleLabel.classList.replace('text-primary', 'text-secondary');
                }
            }

            // Gọi lần đầu khi trang vừa load
            updatePreview();

            // Lắng nghe sự kiện bật/tắt
            toggleBtn.addEventListener('change', updatePreview);
        });
    </script>
}